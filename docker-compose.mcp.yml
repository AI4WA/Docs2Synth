services:
  # MCP Server - SSE transport mode (for ChatGPT compatibility)
  docs2synth-mcp-http:
    build:
      context: .
      dockerfile: Dockerfile.mcp
    image: docs2synth:mcp
    container_name: docs2synth-mcp-http
    ports:
      - "8009:8009"
    volumes:
      - ./data/datasets:/app/data/datasets:ro # Read-only dataset access
      - ./config.example.yml:/app/config.yml:ro # Configuration file
      - ./.docker-local/mcp/logs:/app/logs # Log output
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=info
    working_dir: /app
    command: >
      docs2synth-mcp http
        --host 0.0.0.0
        --port 8009
        --path /mcp
        --transport sse
        --log-level info
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "curl",
          "-s",
          "-o",
          "/dev/null",
          "-w",
          "%{http_code}",
          "http://localhost:8009/mcp",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # # MCP Server - SSE transport mode (alternative)
  # docs2synth-mcp-sse:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.mcp
  #   image: docs2synth:mcp
  #   container_name: docs2synth-mcp-sse
  #   ports:
  #     - "8001:8001" # SSE transport port
  #   volumes:
  #     - ./data/datasets:/app/data/datasets:ro
  #     - ./config.example.yml:/app/config.yml:ro
  #     - ./.docker-local/mcp/logs:/app/logs
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - LOG_LEVEL=info
  #   working_dir: /app
  #   command: >
  #     docs2synth-mcp http
  #       --host 0.0.0.0
  #       --port 8001
  #       --path /docs2synth
  #       --transport sse
  #       --log-level info
  #   restart: unless-stopped
  #   profiles:
  #     - sse
