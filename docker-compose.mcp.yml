services:
  # MCP Server - StreamableHTTP transport (MCP protocol 2025-03-26)
  docs2synth-mcp-sse:
    build:
      context: .
      dockerfile: Dockerfile.mcp
    image: docs2synth:mcp
    container_name: docs2synth-mcp-sse
    ports:
      - "8009:8009"
    volumes:
      - ./data/datasets:/app/data/datasets:ro # Read-only dataset access
      - ./config.example.yml:/app/config.yml:ro # Docs2Synth configuration
      - ./config.mcp.yml:/app/config.mcp.yml:ro # MCP server configuration
      - ./.docker-local/mcp/logs:/app/logs # Log output
    working_dir: /app
    command: >
      docs2synth-mcp sse
        --host 0.0.0.0
        --port 8009
        --log-level info
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "curl",
          "-s",
          "-o",
          "/dev/null",
          "-w",
          "%{http_code}",
          "http://localhost:8009/health",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
